---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# cusumcharter

<!-- badges: start -->

[![R-CMD-check](https://github.com/johnmackintosh/cusumcharter/workflows/R-CMD-check/badge.svg)](https://github.com/johnmackintosh/cusumcharter/actions)

[![Codecov test coverage](https://codecov.io/gh/johnmackintosh/cusumcharter/branch/master/graph/badge.svg)](https://codecov.io/gh/johnmackintosh/cusumcharter?branch=master)

<!-- badges: end -->

The goal of cusumcharter is to create both simple CuSum charts, with and without control limits from a vector, or to create multiple CuSum charts, with or without control limits, from a grouped dataframe, tibble or data.table

## Installation

Install the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("remotes")
remotes::install_github("johnmackintosh/cusumcharter")
```

## A Simple CuSum calculation

This returns the CuSum statistics for a single vector, centred on a supplied target value:

```{r example}
library(cusumcharter)
test_vec <- c(0.175, 0.152, 0.15, 0.207, 0.136, 0.212, 0.166)

CuSum_res <- cusum_single(test_vec, target = 0.16)
CuSum_res
```

## Expanded outputs with cusum_single_df

This function takes a single vector as input and returns a dataframe with additional information used to calculate the CuSum statistic

```{r, example2}
test_vec2 <- c(1,1,2,11,3,5,7,2,4,3,5)
cusum_single_df(test_vec2)
```


## CuSum control limits

Two additional functions allow you to calculate control limits from a single vector and plot a CuSum chart with control limits. This is for a single vector and one chart at a time. 

```{r, example3}
test_vec3 <- c(1,1,2,3,5,7,11,7,5,7,8,9,5)
controls <- cusum_control(test_vec3, target = 4)
controls
```

## CuSum Control Chart

```{r}
test_vec3 <- c(1,1,2,3,5,7,11,7,5,7,8,9,5)
controls <- cusum_control(test_vec3, target = 4)
cusum_control_plot(controls, do_facet = FALSE, title_text = "sample CuSum with controls shows out of control since 7th observation")
```


## Faceted CuSum Control Charts 

```{r}
library(data.table)
library(cusumcharter)

testdata <- data.frame(
  stringsAsFactors = FALSE,
  N = c(1L,2L,1L,3L,1L,1L,1L,1L,1L,
        2L,1L,1L,1L,10L,7L,2L,3L,5L),
  metric = c("metric1","metric1","metric1","metric1","metric1",
           "metric1","metric1","metric1","metric1","metric2",
           "metric2","metric2","metric2","metric2","metric2",
           "metric2","metric2","metric2"))

testlist <- split(testdata$N,testdata$metric)

testres <- lapply(testlist, cusumcharter::cusum_control)

testres <- data.table::rbindlist(testres,fill = TRUE, idcol = TRUE)

p <- cusum_control_plot(testres, do_facet = TRUE, title_text = " faceted CuSum Control plots")
p

```



## Planned functionality

1.  CuSums for single vector with no control limits

2.  CuSum for single vector with control limits

3.  CuSums for multiple groups from dataframe, with no control limits

4.  CuSums for multiple groups from dataframe, with control limits
